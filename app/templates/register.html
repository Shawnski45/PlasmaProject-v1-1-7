<!DOCTYPE html>
<html>
<head>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <title>Register - Plasma Table Burnouts</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Roboto', sans-serif; margin: 20px; background-color: #F4F6F8; color: #2C3E50; }
        .container { max-width: 400px; margin: 0 auto; background-color: #FFFFFF; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); }
        h1 { font-size: 24px; text-align: center; }
        input { width: 100%; padding: 8px; margin: 10px 0; border: 1px solid #E0E0E0; border-radius: 4px; }
        button { width: 100%; padding: 10px; background-color: #27AE60; color: #FFFFFF; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background-color: #219653; }
        .flash-error { color: #E74C3C; text-align: center; }
        .flash-success { color: #27AE60; text-align: center; }
        a { color: #3498DB; text-decoration: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Register</h1>
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <p class="flash-{{ category }}">{{ message }}</p>
                {% endfor %}
            {% endif %}
        {% endwith %}
        <form id="registerForm">
            <input type="text" name="company" placeholder="Company (Optional)">
            <input type="text" name="first_name" placeholder="First Name" required>
            <input type="text" name="last_name" placeholder="Last Name" required>
            <input type="email" name="email" placeholder="Email" required>
            <input type="tel" name="phone" placeholder="Phone (10 digits)" pattern="[0-9]{10}" title="Enter a 10-digit phone number" required>
            <input type="password" name="password" placeholder="Password" required>
            <button type="submit">Register</button>
        </form>
        <div id="register-message"></div>
        <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
        <script>
          document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const email = this.email.value;
            const password = this.password.value;
            const messageDiv = document.getElementById('register-message');
            try {
              const userCredential = await firebase.auth().createUserWithEmailAndPassword(email, password);
              const idToken = await userCredential.user.getIdToken();
              // Send ID token to backend for session
              const response = await fetch('/auth/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ id_token: idToken })
              });
              if (response.ok) {
                messageDiv.innerHTML = '<p class="flash-success">Registration successful! Redirecting...</p>';
                setTimeout(() => { window.location.href = '/'; }, 1000);
              } else {
                const res = await response.json();
                messageDiv.innerHTML = `<p class="flash-error">${res.error || 'Registration failed.'}</p>`;
              }
            } catch (error) {
              messageDiv.innerHTML = `<p class="flash-error">${error.message}</p>`;
            }
          });
        </script>
        <p>Already have an account? <button type="button" onclick="window.openModal && window.openModal('loginModal')">Login</button></p>
    </div>
</body>
</html>